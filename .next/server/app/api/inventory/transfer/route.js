"use strict";(()=>{var r={};r.id=1297,r.ids=[1297],r.modules={53524:r=>{r.exports=require("@prisma/client")},30517:r=>{r.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},21421:(r,t,e)=>{e.r(t),e.d(t,{headerHooks:()=>y,originalPathname:()=>_,patchFetch:()=>w,requestAsyncStorage:()=>p,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>v});var a={};e.r(a),e.d(a,{POST:()=>c});var n=e(95419),i=e(69108),o=e(99678),s=e(78070),u=e(3214),d=e(34765);async function c(r){try{let{fromBranchId:t,toBranchId:e,items:a,userId:n}=await r.json();if(!t||!e||!a||!Array.isArray(a)||0===a.length||!n)return s.Z.json({error:"Missing required fields"},{status:400});if(t===e)return s.Z.json({error:"Source and destination branches must be different"},{status:400});return await u.Z.$transaction(async r=>{for(let i of a){let{productId:a,quantity:o}=i;if(!a||!o||o<=0)throw Error(`Invalid item data for product ${a}`);await (0,d.U)(r,a,t,-o,"TRANSFER_OUT",n),await (0,d.U)(r,a,e,o,"TRANSFER_IN",n)}}),s.Z.json({message:"Transfer successful"},{status:200})}catch(r){return console.error("Transfer error:",r),s.Z.json({error:r.message||"Transfer failed"},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/inventory/transfer/route",pathname:"/api/inventory/transfer",filename:"route",bundlePath:"app/api/inventory/transfer/route"},resolvedPagePath:"C:\\Users\\mubar\\Desktop\\MADAR\\app\\api\\inventory\\transfer\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:l,serverHooks:h,headerHooks:y,staticGenerationBailout:v}=f,_="/api/inventory/transfer/route";function w(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:l})}},34765:(r,t,e)=>{e.d(t,{U:()=>n,e:()=>i});var a=e(3214);async function n(r,t,e,a,n,i,o){let s=await r.inventory.findUnique({where:{product_id_branch_id:{product_id:t,branch_id:e}}});if(!s){if(a<0)throw Error(`Insufficient stock: Product ${t} not found in branch ${e}`);s=await r.inventory.create({data:{product_id:t,branch_id:e,quantity:0}})}let u=s.quantity+a;if(u<0)throw Error(`Insufficient stock for Product ${t} at Branch ${e}. Current: ${s.quantity}, Requested: ${Math.abs(a)}`);let d=await r.inventory.update({where:{product_id_branch_id:{product_id:t,branch_id:e}},data:{quantity:u}});return await r.stockMovement.create({data:{product_id:t,branch_id:e,type:n,quantity:a,reference_id:o,user_id:i,date:new Date}}),d.quantity<=d.reorder_level&&console.warn(`LOW STOCK ALERT: Product ${t} at Branch ${e} is at ${d.quantity}`),d}async function i(r,t,e,i,o,s){return await a.Z.$transaction(async a=>n(a,r,t,e,i,o,s))}},3214:(r,t,e)=>{e.d(t,{Z:()=>n});var a=e(53524);let n=global.prisma||new a.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(r);var e=r=>t(t.s=r),a=t.X(0,[1638,6206],()=>e(21421));module.exports=a})();