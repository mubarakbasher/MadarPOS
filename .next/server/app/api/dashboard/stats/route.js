"use strict";(()=>{var e={};e.id=6041,e.ids=[6041],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},46537:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>_,originalPathname:()=>w,patchFetch:()=>b,requestAsyncStorage:()=>c,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>h});var r={};a.r(r),a.d(r,{GET:()=>d,dynamic:()=>l});var s=a(95419),o=a(69108),n=a(99678),u=a(78070);let i=new(a(53524)).PrismaClient,l="force-dynamic";async function d(){try{let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()),a=new Date(e.getFullYear(),e.getMonth(),1),r=(await i.sale.aggregate({_sum:{total_amount:!0}}))._sum.total_amount||0,s=(await i.sale.aggregate({where:{sale_date:{gte:t}},_sum:{total_amount:!0}}))._sum.total_amount||0,o=(await i.sale.aggregate({where:{sale_date:{gte:a}},_sum:{total_amount:!0}}))._sum.total_amount||0,n=await i.sale.count(),l=await i.sale.count({where:{sale_date:{gte:t}}}),d=await i.$queryRaw`
            SELECT COUNT(*) as count FROM Inventory WHERE quantity <= reorder_level
        `,m=Number(d[0]?.count||0),c=(await i.sale.findMany({take:5,orderBy:{sale_date:"desc"},include:{user:{select:{full_name:!0}}}})).map(e=>({id:e.sale_id,invoice:e.invoice_number,user:e.user.full_name,total:Number(e.total_amount),date:e.sale_date}));return u.Z.json({totalRevenue:Number(r),todayRevenue:Number(s),monthRevenue:Number(o),totalSales:n,todaySales:l,lowStockCount:m,recentSales:c})}catch(e){return console.error("Dashboard API Error:",e),u.Z.json({message:"Error fetching stats"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/dashboard/stats/route",pathname:"/api/dashboard/stats",filename:"route",bundlePath:"app/api/dashboard/stats/route"},resolvedPagePath:"C:\\Users\\mubar\\Desktop\\MADAR\\app\\api\\dashboard\\stats\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:c,staticGenerationAsyncStorage:p,serverHooks:g,headerHooks:_,staticGenerationBailout:h}=m,w="/api/dashboard/stats/route";function b(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:p})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[1638,6206],()=>a(46537));module.exports=r})();