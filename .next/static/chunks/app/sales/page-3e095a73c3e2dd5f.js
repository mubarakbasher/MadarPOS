(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[371],{95779:function(e,t,r){Promise.resolve().then(r.bind(r,65990))},65990:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return S}});var s=r(3827),n=r(64547),a=r(64090),i=r(52235),o=r(63915),l=r(44715),d=r(52874),c=r.n(d),m=r(92493),x=e=>{var t,r,n,d,x,u;let{isOpen:p,onClose:b,saleData:h}=e,g=(0,a.useRef)(null),[f,y]=(0,a.useState)(null),[j,v]=(0,a.useState)(!1);if((0,a.useEffect)(()=>{p&&fetch("/api/settings").then(e=>e.json()).then(e=>y(e)).catch(e=>console.error("Failed to load settings:",e))},[p]),!p||!h)return null;let N=async()=>{if(g.current&&!j){v(!0);try{let e=await c()(g.current,{scale:2,backgroundColor:"#ffffff",logging:!1,useCORS:!0}),t=210*e.height/e.width,r=new m.ZP({orientation:"portrait",unit:"mm",format:"a4"}),s=e.toDataURL("image/png");r.addImage(s,"PNG",0,0,210,t);let n=r.output("blob"),a=URL.createObjectURL(n),i=window.open(a,"_blank");i&&(i.onload=()=>{i.print()})}catch(e){console.error("Error generating PDF for print:",e),alert("Failed to prepare receipt for printing. Please try again.")}finally{v(!1)}}},w=async()=>{if(g.current&&!j){v(!0);try{let e=await c()(g.current,{scale:2,backgroundColor:"#ffffff",logging:!1,useCORS:!0}),t=210*e.height/e.width,r=new m.ZP({orientation:"portrait",unit:"mm",format:"a4"}),s=e.toDataURL("image/png");r.addImage(s,"PNG",0,0,210,t);let n=h.invoice_number||"receipt";r.save("receipt-".concat(n,".pdf"))}catch(e){console.error("Error generating PDF:",e),alert("Failed to generate PDF. Please try again.")}finally{v(!1)}}},k=(null==f?void 0:f.system_name)||"MADAR POS",C={USD:"$",EUR:"€",GBP:"\xa3",SAR:"﷼",AED:"د.إ",EGP:"\xa3",SDN:"ج.س"}[u=(null==f?void 0:f.currency)||"USD"]||u;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("style",{dangerouslySetInnerHTML:{__html:"\n                @media print {\n                    body {\n                        margin: 0;\n                        padding: 0;\n                    }\n                    \n                    /* Remove backdrop overlay styling for print */\n                    .receipt-modal-backdrop {\n                        background: white !important;\n                        position: static !important;\n                        display: block !important;\n                        padding: 0 !important;\n                        margin: 0 !important;\n                    }\n                    \n                    .receipt-modal-content {\n                        max-width: 100% !important;\n                        max-height: none !important;\n                        box-shadow: none !important;\n                        border: none !important;\n                        margin: 0 !important;\n                        padding: 0 !important;\n                        border-radius: 0 !important;\n                        background: white !important;\n                        overflow: visible !important;\n                    }\n                    \n                    /* Hide all buttons, headers, and controls */\n                    .print-hidden {\n                        display: none !important;\n                    }\n                    \n                    /* Make receipt content fill the page */\n                    #receipt-content {\n                        overflow: visible !important;\n                        max-height: none !important;\n                        padding: 0 !important;\n                        background: white !important;\n                    }\n                    \n                    /* Clean up backgrounds */\n                    #receipt-content * {\n                        background: transparent !important;\n                    }\n                    \n                    /* Preserve borders */\n                    .border-b {\n                        border-bottom: 1px solid #000 !important;\n                    }\n                    \n                    .border-t {\n                        border-top: 1px solid #000 !important;\n                    }\n                    \n                    .border-dashed {\n                        border-style: dashed !important;\n                        border-color: #666 !important;\n                    }\n                    \n                    /* Table styling */\n                    table {\n                        border-collapse: collapse !important;\n                        width: 100% !important;\n                    }\n                    \n                    /* Text colors */\n                    #receipt-content {\n                        color: black !important;\n                    }\n                    \n                    .text-gray-600,\n                    .text-muted-foreground {\n                        color: #666 !important;\n                    }\n                    \n                    .text-green-600 {\n                        color: #16a34a !important;\n                    }\n                    \n                    /* Page settings */\n                    @page {\n                        margin: 15mm;\n                        size: auto;\n                    }\n                }\n\n                /* Screen styles for modal */\n                @media screen {\n                    .receipt-modal-backdrop {\n                        position: fixed;\n                        inset: 0;\n                        z-index: 9999;\n                        background-color: rgba(0, 0, 0, 0.5);\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        animation: fadeIn 0.2s ease-in-out;\n                    }\n\n                    @keyframes fadeIn {\n                        from { opacity: 0; }\n                        to { opacity: 1; }\n                    }\n\n                    @keyframes slideUp {\n                        from { transform: translateY(20px); opacity: 0; }\n                        to { transform: translateY(0); opacity: 1; }\n                    }\n\n                    .receipt-modal-content {\n                        animation: slideUp 0.3s ease-out;\n                    }\n                }\n            "}}),(0,s.jsx)("div",{className:"receipt-modal-backdrop",children:(0,s.jsxs)("div",{className:"receipt-modal-content bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden flex flex-col shadow-2xl border border-gray-200",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center p-4 border-b border-gray-200 bg-gray-50/50 print-hidden",children:[(0,s.jsx)("h3",{className:"font-bold text-lg text-gray-800",children:"Sale Receipt"}),(0,s.jsx)("button",{onClick:b,className:"text-gray-500 hover:text-red-500 transition-colors p-1 rounded-md hover:bg-gray-100","aria-label":"Close",children:(0,s.jsx)(i.Z,{size:20})})]}),(0,s.jsxs)("div",{ref:g,className:"overflow-y-auto p-6 flex-1",id:"receipt-content",children:[(0,s.jsxs)("div",{className:"text-center mb-6 receipt-section",children:[(null==f?void 0:f.logo)&&(0,s.jsx)("img",{src:f.logo,alt:"Logo",className:"h-12 mx-auto mb-2"}),(0,s.jsx)("h2",{className:"text-2xl font-bold uppercase tracking-wide mb-1",children:k}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-0.5",children:(null===(t=h.branch)||void 0===t?void 0:t.branch_name)||"Main Branch"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-0.5",children:(null===(r=h.branch)||void 0===r?void 0:r.location)||"Location not set"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:(null===(n=h.branch)||void 0===n?void 0:n.phone)||"Phone not set"})]}),(0,s.jsx)("div",{className:"border-b border-dashed border-gray-300 my-4"}),(0,s.jsxs)("div",{className:"mb-4 text-sm receipt-section",children:[(0,s.jsxs)("div",{className:"flex justify-between mb-1.5",children:[(0,s.jsx)("span",{className:"text-gray-600 font-medium",children:"Invoice:"}),(0,s.jsx)("span",{className:"font-semibold",children:h.invoice_number})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-1.5",children:[(0,s.jsx)("span",{className:"text-gray-600 font-medium",children:"Date:"}),(0,s.jsx)("span",{children:new Date(h.sale_date).toLocaleString()})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-1.5",children:[(0,s.jsx)("span",{className:"text-gray-600 font-medium",children:"Cashier:"}),(0,s.jsx)("span",{children:(null===(d=h.user)||void 0===d?void 0:d.full_name)||"Admin"})]}),h.customer&&(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600 font-medium",children:"Customer:"}),(0,s.jsx)("span",{children:h.customer.full_name})]})]}),(0,s.jsx)("div",{className:"border-b border-dashed border-gray-300 my-4"}),(0,s.jsx)("div",{className:"mb-4 receipt-section",children:(0,s.jsxs)("table",{className:"w-full text-sm border-collapse",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-gray-300",children:[(0,s.jsx)("th",{className:"pb-2 text-left font-semibold text-gray-700",children:"Item"}),(0,s.jsx)("th",{className:"pb-2 text-right font-semibold text-gray-700",children:"Qty"}),(0,s.jsx)("th",{className:"pb-2 text-right font-semibold text-gray-700",children:"Price"}),(0,s.jsx)("th",{className:"pb-2 text-right font-semibold text-gray-700",children:"Total"})]})}),(0,s.jsx)("tbody",{children:null===(x=h.sale_items)||void 0===x?void 0:x.map(e=>{var t,r;let n=Number(e.subtotal),a=Number(e.discount||0);return(0,s.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,s.jsxs)("td",{className:"py-2 pr-2",children:[(0,s.jsx)("div",{className:"font-medium text-gray-800",children:(null===(t=e.product)||void 0===t?void 0:t.name)||"Item"}),(null===(r=e.product)||void 0===r?void 0:r.sku)&&(0,s.jsx)("div",{className:"text-xs text-gray-500 font-mono",children:e.product.sku}),a>0&&(0,s.jsxs)("div",{className:"text-xs text-green-600 font-medium",children:["Discount: -",C,a.toFixed(2)]})]}),(0,s.jsx)("td",{className:"py-2 text-right align-top",children:e.quantity}),(0,s.jsxs)("td",{className:"py-2 text-right align-top",children:[C,Number(e.unit_price).toFixed(2)]}),(0,s.jsxs)("td",{className:"py-2 text-right align-top font-medium",children:[C,n.toFixed(2)]})]},e.sale_item_id)})})]})}),(0,s.jsx)("div",{className:"border-b border-dashed border-gray-300 my-4"}),(0,s.jsxs)("div",{className:"receipt-section",children:[(0,s.jsxs)("div",{className:"flex justify-between mb-2 text-sm",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Subtotal"}),(0,s.jsxs)("span",{className:"font-medium",children:[C,(Number(h.total_amount)-Number(h.tax)+Number(h.discount)).toFixed(2)]})]}),Number(h.discount)>0&&(0,s.jsxs)("div",{className:"flex justify-between mb-2 text-sm text-green-600",children:[(0,s.jsx)("span",{className:"font-medium",children:"Discount"}),(0,s.jsxs)("span",{className:"font-medium",children:["-",C,Number(h.discount).toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2 text-sm",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Tax"}),(0,s.jsxs)("span",{className:"font-medium",children:[C,Number(h.tax).toFixed(2)]})]}),(0,s.jsx)("div",{className:"border-t border-gray-300 mt-3 pt-3",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-lg font-bold text-gray-800",children:"TOTAL"}),(0,s.jsxs)("span",{className:"text-2xl font-bold text-gray-900",children:[C,Number(h.total_amount).toFixed(2)]})]})}),(0,s.jsx)("div",{className:"mt-3 text-center",children:(0,s.jsxs)("span",{className:"inline-block px-3 py-1 bg-gray-100 rounded-full text-xs font-semibold text-gray-700 uppercase",children:["Paid via ",h.payment_method]})})]}),(0,s.jsxs)("div",{className:"text-center text-xs text-gray-500 mt-8 receipt-section",children:[(0,s.jsx)("p",{className:"mb-1 font-medium",children:"Thank you for shopping with us!"}),(0,s.jsx)("p",{className:"mb-1",children:"Please keep this receipt for returns."}),(0,s.jsxs)("div",{className:"mt-4 font-mono text-[10px] opacity-50",children:["Receipt ID: ",h.sale_id]})]})]}),(0,s.jsxs)("div",{className:"p-4 border-t border-gray-200 bg-gray-50/50 print-hidden",children:[(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,s.jsx)("button",{onClick:b,className:"px-4 py-2.5 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors font-medium text-sm text-gray-700",children:"Close"}),(0,s.jsxs)("button",{onClick:N,disabled:j,className:"px-4 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium text-sm flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,s.jsx)(o.Z,{size:16}),j?"Preparing...":"Print"]}),(0,s.jsxs)("button",{onClick:w,disabled:j,className:"px-4 py-2.5 bg-primary text-white rounded-lg hover:opacity-90 transition-opacity font-medium text-sm flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:"var(--primary)"},children:[(0,s.jsx)(l.Z,{size:16}),j?"Generating...":"Save PDF"]})]}),(0,s.jsx)("p",{className:"text-center text-xs text-gray-500 mt-2",children:'Tip: Click "Print" to print receipt or "Save PDF" to download'})]})]})})]})},u=r(28670),p=r(50489),b=r(11213),h=r(70094),g=r(34059),f=r(82800),y=r(3665),j=r(27271),v=r(10822),N=r(79229),w=r(10527),k=r(85083),C=r(47907);function S(){(0,C.useRouter)();let[e,t]=(0,a.useState)(""),[r,o]=(0,a.useState)("All"),[l,d]=(0,a.useState)([]),[c,m]=(0,a.useState)([]),[S,_]=(0,a.useState)(!0),[F,D]=(0,a.useState)(!1),[z,P]=(0,a.useState)(null),[Z,T]=(0,a.useState)(!1),[q,E]=(0,a.useState)(""),[R,A]=(0,a.useState)([]),[I,L]=(0,a.useState)(!1),[O,$]=(0,a.useState)(!1),[U,M]=(0,a.useState)(null),[G,B]=(0,a.useState)({value:0,type:"fixed"}),[H,Q]=(0,a.useState)(!1),[W,Y]=(0,a.useState)(null),[J,V]=(0,a.useState)({value:0,type:"fixed"});(0,a.useEffect)(()=>{let e=setTimeout(async()=>{if(Z){L(!0);try{let e=await fetch("/api/customers?search=".concat(encodeURIComponent(q)));if(e.ok){let t=await e.json();A(t)}}catch(e){console.error("Failed to search customers",e)}finally{L(!1)}}},300);return()=>clearTimeout(e)},[q,Z]),(0,a.useEffect)(()=>{(async function(){try{let e=await fetch("/api/pos/products");if(e.ok){let t=await e.json();d(t)}}catch(e){console.error("Failed to load products",e)}finally{_(!1)}})()},[]);let K=l.filter(t=>{let s=t.name.toLowerCase().includes(e.toLowerCase())||t.sku.toLowerCase().includes(e.toLowerCase()),n="All"===r||t.category.category_name===r;return s&&n}),X=e=>{var t;let r=(null===(t=e.inventory[0])||void 0===t?void 0:t.quantity)||0;if(r<=0)return alert("Out of stock");m(t=>{let s=t.find(t=>t.id===e.product_id);return s?s.quantity>=r?(alert("Not enough stock available"),t):t.map(t=>t.id===e.product_id?{...t,quantity:t.quantity+1}:t):[...t,{id:e.product_id,name:e.name,price:Number(e.selling_price),quantity:1,maxStock:r,discount:0,discountType:"fixed"}]})},ee=(e,t)=>{m(r=>r.map(r=>{if(r.id===e){let e=r.quantity+t;return e>r.maxStock?(alert("Max stock reached"),r):e>0?{...r,quantity:e}:r}return r}))},et=e=>{m(t=>t.filter(t=>t.id!==e))},er=(e,t,r)=>{m(s=>s.map(s=>s.id===e?{...s,discount:t,discountType:r}:s)),Y(null)},es=c.reduce((e,t)=>e+t.price*t.quantity,0),en=c.reduce((e,t)=>{let r=t.price*t.quantity;return e+("fixed"===t.discountType?Math.min(t.discount,r):t.discount/100*r)},0),ea=Math.max(0,es-en),ei="fixed"===G.type?Math.min(G.value,ea):G.value/100*ea,eo=Math.max(0,ea-ei),el=.1*eo,ed=eo+el,ec=en+ei,em=async e=>{if(0!==c.length){D(!0);try{let t=await fetch("/api/sales/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:c.map(e=>{let t=e.price*e.quantity,r="fixed"===e.discountType?e.discount:e.discount/100*t;return{productId:e.id,quantity:e.quantity,price:e.price,name:e.name,discount:r}}),paymentMethod:e,subtotal:es,tax:el,discount:ec,total:ed,customerId:null==z?void 0:z.customer_id})});if(!t.ok)throw Error("Checkout failed");let r=await t.json();try{let e=await fetch("/api/sales/".concat(r.saleId));if(e.ok){let t=await e.json();M(t),$(!0)}}catch(e){console.error("Failed to fetch receipt data",e),alert("Sale Completed! ID: ".concat(r.saleId," (Receipt load failed)"))}m([]),P(null)}catch(e){alert("Error processing sale")}finally{D(!1)}}};if(S)return(0,s.jsx)("div",{className:"p-8",children:"Loading POS..."});let ex=["All",...Array.from(new Set(l.map(e=>e.category.category_name)))];return(0,s.jsxs)("div",{className:"flex h-screen flex-col bg-background overflow-hidden font-sans text-foreground",children:[(0,s.jsx)(n.default,{title:"Point of Sale"}),(0,s.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex flex-col flex-1 border-r border-border bg-gray-50/30 dark:bg-black/20",children:[(0,s.jsxs)("div",{className:"px-6 py-4 space-y-4",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(u.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground w-4 h-4"}),(0,s.jsx)("input",{type:"text",placeholder:"Search products...",value:e,onChange:e=>t(e.target.value),className:"w-full pl-10 pr-4 py-3 rounded-xl border border-border bg-card shadow-sm focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all outline-none"})]}),(0,s.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-1 scrollbar-hide",children:ex.map((e,t)=>(0,s.jsx)("button",{onClick:()=>o(e),className:"px-4 py-2 rounded-full text-sm font-medium transition-all whitespace-nowrap ".concat(r===e?"bg-primary text-primary-foreground shadow-md shadow-primary/25":"bg-card text-muted-foreground border border-border hover:bg-muted/50"),children:e},e))})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 p-6 pt-0 overflow-y-auto content-start",children:K.map(e=>{var t;let r=(null===(t=e.inventory[0])||void 0===t?void 0:t.quantity)||0;return(0,s.jsxs)("div",{onClick:()=>X(e),className:"group relative bg-card rounded-xl border border-border hover:border-primary/50 cursor-pointer transition-all duration-200 hover:shadow-lg hover:-translate-y-1 overflow-hidden ".concat(0===r?"opacity-60 grayscale":""),children:[(0,s.jsx)("div",{className:"h-32 bg-gradient-to-br from-indigo-50 to-blue-50 dark:from-indigo-950/30 dark:to-blue-950/30 flex items-center justify-center text-4xl group-hover:scale-110 transition-transform duration-300",children:"Electronics"===e.category.category_name?"\uD83D\uDCBB":"\uD83D\uDCE6"}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsx)("div",{className:"flex justify-between items-start mb-1",children:(0,s.jsx)("p",{className:"font-semibold text-sm truncate flex-1 pr-2",title:e.name,children:e.name})}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mb-3 font-mono",children:e.sku}),(0,s.jsxs)("div",{className:"flex justify-between items-end",children:[(0,s.jsxs)("span",{className:"font-bold text-lg text-primary",children:["$",Number(e.selling_price).toFixed(2)]}),(0,s.jsxs)("span",{className:"text-xs px-2 py-1 rounded-md font-medium ".concat(r<5?"bg-red-100 text-red-700 dark:bg-red-950/50 dark:text-red-400":"bg-green-100 text-green-700 dark:bg-green-950/50 dark:text-green-400"),children:[r," left"]})]})]}),(0,s.jsx)("div",{className:"absolute inset-0 bg-primary/0 group-hover:bg-primary/5 transition-colors pointer-events-none"})]},e.product_id)})})]}),(0,s.jsxs)("div",{className:"w-[400px] flex-shrink-0 bg-card flex flex-col shadow-xl border-l border-border z-20",children:[(0,s.jsxs)("div",{className:"p-5 border-b border-border bg-card",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"font-bold text-xl tracking-tight",children:"Current Order"}),(0,s.jsxs)("button",{onClick:()=>m([]),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-semibold text-red-600 bg-red-50 hover:bg-red-100 border border-red-100 transition-colors dark:bg-red-950/30 dark:text-red-400 dark:border-red-900/50",children:[(0,s.jsx)(p.Z,{size:14}),(0,s.jsx)("span",{children:"Clear"})]})]}),(0,s.jsx)("div",{className:"p-3 rounded-xl border transition-all ".concat(z?"bg-primary/5 border-primary/20":"bg-muted/30 border-dashed border-border hover:bg-muted/50"),children:z?(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full bg-primary text-primary-foreground flex items-center justify-center shadow-sm",children:(0,s.jsx)(b.Z,{size:18})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold text-sm ",children:z.full_name}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:z.phone||z.email})]})]}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),P(null)},className:"text-muted-foreground hover:text-red-500 p-1 transition-colors",children:(0,s.jsx)(i.Z,{size:16})})]}):(0,s.jsxs)("button",{onClick:()=>T(!0),className:"w-full flex items-center justify-center gap-2 text-sm font-medium text-muted-foreground py-1",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-muted flex items-center justify-center",children:(0,s.jsx)(h.Z,{size:16})}),(0,s.jsx)("span",{children:"Add Customer"})]})})]}),Z&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-in fade-in duration-200",children:(0,s.jsxs)("div",{className:"bg-card w-full max-w-md rounded-2xl shadow-2xl border border-border flex flex-col max-h-[85vh] overflow-hidden animate-in zoom-in-95 duration-200",children:[(0,s.jsxs)("div",{className:"p-4 border-b border-border flex justify-between items-center bg-gray-50/50 dark:bg-gray-900/50",children:[(0,s.jsx)("h3",{className:"font-bold text-lg",children:"Select Customer"}),(0,s.jsx)("button",{onClick:()=>T(!1),className:"text-muted-foreground hover:text-foreground transition-colors",children:(0,s.jsx)(i.Z,{size:20})})]}),(0,s.jsxs)("div",{className:"p-4 space-y-4",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(u.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground w-4 h-4"}),(0,s.jsx)("input",{autoFocus:!0,type:"text",placeholder:"Search by name, phone...",value:q,onChange:e=>E(e.target.value),className:"w-full pl-9 pr-4 py-2.5 rounded-lg border border-border bg-background focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none text-sm"})]}),(0,s.jsx)("div",{className:"overflow-y-auto max-h-[300px] space-y-2 pr-1",children:I?(0,s.jsx)("div",{className:"py-8 text-center text-muted-foreground text-sm animate-pulse",children:"Searching..."}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{onClick:()=>{P(null),T(!1)},className:"p-3 rounded-lg border border-dashed border-border hover:bg-muted/50 cursor-pointer flex items-center gap-3 transition-colors",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-muted flex items-center justify-center text-muted-foreground",children:(0,s.jsx)(g.Z,{size:16})}),(0,s.jsx)("span",{className:"font-medium text-sm",children:"Walk-in Customer"})]}),R.map(e=>(0,s.jsxs)("div",{onClick:()=>{P(e),T(!1)},className:"p-3 rounded-lg border cursor-pointer flex items-center gap-3 transition-colors ".concat((null==z?void 0:z.customer_id)===e.customer_id?"bg-primary/5 border-primary/30":"border-transparent hover:bg-muted/50"),children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-300 flex items-center justify-center text-xs font-bold ring-2 ring-white dark:ring-gray-800",children:e.full_name.charAt(0).toUpperCase()}),(0,s.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,s.jsx)("span",{className:"text-sm font-semibold",children:e.full_name}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:e.phone||e.email})]}),0!==e.balance&&(0,s.jsx)("span",{className:"text-xs font-medium px-2 py-0.5 rounded-full ".concat(e.balance>0?"bg-green-100 text-green-700 dark:bg-green-950/40 dark:text-green-400":"bg-red-100 text-red-700 dark:bg-red-950/40 dark:text-red-400"),children:e.balance>0?"+".concat(e.balance):e.balance})]},e.customer_id)),0===R.length&&!I&&(0,s.jsx)("div",{className:"py-8 text-center text-muted-foreground text-sm",children:"No customers found"})]})})]})]})}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50/30 dark:bg-black/10",children:[0===c.length&&(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground py-10",children:[(0,s.jsx)("div",{className:"w-16 h-16 rounded-full bg-muted/50 flex items-center justify-center mb-4",children:(0,s.jsx)(f.Z,{size:24,className:"opacity-50"})}),(0,s.jsx)("p",{className:"font-medium",children:"Cart is empty"}),(0,s.jsx)("p",{className:"text-xs mt-1 opacity-70",children:"Tap items to add them"})]}),c.map(e=>(0,s.jsxs)("div",{className:"bg-card rounded-xl p-3 border border-border shadow-sm flex flex-col gap-3 group",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start gap-2",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"font-semibold text-sm truncate",children:e.name}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,s.jsxs)("span",{className:"text-xs text-muted-foreground font-mono",children:["$",e.price.toFixed(2)]}),e.discount>0&&(0,s.jsxs)("span",{className:"text-[10px] font-bold text-green-600 bg-green-50 px-1.5 py-0.5 rounded border border-green-100 dark:bg-green-950/30 dark:text-green-400 dark:border-green-900/50",children:["-","fixed"===e.discountType?"$"+e.discount:e.discount+"%"]})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("span",{className:"font-bold text-sm block",children:["$",(e.price*e.quantity-("fixed"===e.discountType?Math.min(e.discount,e.price*e.quantity):e.price*e.quantity*(e.discount/100))).toFixed(2)]}),e.discount>0&&(0,s.jsxs)("span",{className:"text-[10px] text-muted-foreground line-through decoration-red-400/50",children:["$",(e.price*e.quantity).toFixed(2)]})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[W===e.id?(0,s.jsxs)("div",{className:"flex items-center gap-1.5 animate-in slide-in-from-left-2 fade-in duration-200",children:[(0,s.jsx)("input",{type:"number",className:"w-14 p-1 text-xs border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:J.value,onChange:e=>V({...J,value:Number(e.target.value)}),autoFocus:!0}),(0,s.jsxs)("select",{className:"p-1 text-xs border rounded bg-background focus:ring-1 focus:ring-primary outline-none",value:J.type,onChange:e=>V({...J,type:e.target.value}),children:[(0,s.jsx)("option",{value:"fixed",children:"$"}),(0,s.jsx)("option",{value:"percent",children:"%"})]}),(0,s.jsx)("button",{onClick:()=>er(e.id,J.value,J.type),className:"w-5 h-5 flex items-center justify-center bg-primary text-primary-foreground rounded hover:bg-primary/90",children:(0,s.jsx)(y.Z,{size:10})}),(0,s.jsx)("button",{onClick:()=>Y(null),className:"w-5 h-5 flex items-center justify-center text-muted-foreground hover:bg-muted rounded",children:(0,s.jsx)(i.Z,{size:12})})]}):(0,s.jsxs)("button",{onClick:()=>{Y(e.id),V({value:e.discount,type:e.discountType})},className:"text-xs text-primary/80 hover:text-primary hover:underline flex items-center gap-1 transition-colors",children:[(0,s.jsx)(y.Z,{size:12})," ",e.discount>0?"Edit":"Discount"]}),(0,s.jsxs)("div",{className:"flex items-center bg-muted/50 rounded-lg p-0.5 border border-border",children:[(0,s.jsx)("button",{onClick:()=>ee(e.id,-1),className:"w-7 h-7 flex items-center justify-center rounded-md hover:bg-background hover:shadow-sm transition-all text-muted-foreground hover:text-foreground active:scale-95",children:(0,s.jsx)(j.Z,{size:14})}),(0,s.jsx)("span",{className:"w-8 text-center text-sm font-semibold font-mono",children:e.quantity}),(0,s.jsx)("button",{onClick:()=>ee(e.id,1),className:"w-7 h-7 flex items-center justify-center rounded-md hover:bg-background hover:shadow-sm transition-all text-muted-foreground hover:text-foreground active:scale-95",children:(0,s.jsx)(h.Z,{size:14})})]})]}),(0,s.jsx)("button",{onClick:()=>et(e.id),className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 p-1.5 text-red-400 hover:text-red-500 hover:bg-red-50 rounded-full transition-all",children:(0,s.jsx)(p.Z,{size:14})})]},e.id))]}),(0,s.jsxs)("div",{className:"p-5 bg-card border-t border-border shadow-[0_-5px_15px_-5px_rgba(0,0,0,0.05)] z-30",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm mb-2 text-muted-foreground",children:[(0,s.jsx)("span",{children:"Subtotal"}),(0,s.jsxs)("span",{className:"font-mono text-foreground",children:["$",es.toFixed(2)]})]}),ec>0&&(0,s.jsxs)("div",{className:"flex justify-between text-sm mb-2 text-green-600 font-medium",children:[(0,s.jsx)("span",{children:"Total Savings"}),(0,s.jsxs)("span",{className:"font-mono",children:["-$",ec.toFixed(2)]})]}),(0,s.jsx)("div",{className:"mb-3",children:H?(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-1 animate-in slide-in-from-top-1 fade-in",children:[(0,s.jsx)("input",{type:"number",className:"w-20 p-1.5 text-sm border rounded bg-background focus:ring-1 focus:ring-primary outline-none",placeholder:"0",value:G.value,onChange:e=>B({...G,value:Number(e.target.value)}),autoFocus:!0}),(0,s.jsxs)("div",{className:"flex border rounded overflow-hidden bg-muted/50 p-0.5",children:[(0,s.jsx)("button",{onClick:()=>B({...G,type:"fixed"}),className:"px-2.5 py-1 text-xs rounded transition-all ".concat("fixed"===G.type?"bg-background shadow-sm font-bold text-foreground":"text-muted-foreground hover:text-foreground"),children:"$"}),(0,s.jsx)("button",{onClick:()=>B({...G,type:"percent"}),className:"px-2.5 py-1 text-xs rounded transition-all ".concat("percent"===G.type?"bg-background shadow-sm font-bold text-foreground":"text-muted-foreground hover:text-foreground"),children:"%"})]}),(0,s.jsx)("button",{onClick:()=>Q(!1),className:"px-2 py-1 text-xs bg-primary text-primary-foreground rounded hover:bg-primary/90",children:"Done"})]}):(0,s.jsxs)("button",{onClick:()=>Q(!0),className:"text-xs text-primary/80 hover:text-primary hover:underline flex items-center gap-1 transition-colors",children:[(0,s.jsx)(v.Z,{size:12})," ",G.value>0?"Edit Global Discount":"Add Order Discount"]})}),(0,s.jsxs)("div",{className:"flex justify-between text-sm mb-4 text-muted-foreground",children:[(0,s.jsx)("span",{children:"Tax (10%)"}),(0,s.jsxs)("span",{className:"font-mono text-foreground",children:["$",el.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-end mb-6 pt-4 border-t border-dashed border-border",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground block mb-0.5",children:"Total Amount"}),(0,s.jsxs)("span",{className:"text-3xl font-bold tracking-tight text-foreground",children:["$",ed.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground mb-1",children:[c.length," items"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[(0,s.jsxs)("button",{onClick:()=>em("Cash"),disabled:F||0===c.length,className:"flex items-center justify-center gap-2 py-3 px-4 rounded-xl border border-border bg-background hover:bg-gray-50 hover:border-primary/30 transition-all disabled:opacity-50 disabled:cursor-not-allowed group active:scale-[0.98]",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-green-50 text-green-600 flex items-center justify-center group-hover:scale-110 transition-transform dark:bg-green-950/30 dark:text-green-400",children:(0,s.jsx)(N.Z,{size:18})}),(0,s.jsx)("span",{className:"font-semibold text-sm",children:"Cash"})]}),(0,s.jsxs)("button",{onClick:()=>em("Card"),disabled:F||0===c.length,className:"flex items-center justify-center gap-2 py-3 px-4 rounded-xl border border-border bg-background hover:bg-gray-50 hover:border-primary/30 transition-all disabled:opacity-50 disabled:cursor-not-allowed group active:scale-[0.98]",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center group-hover:scale-110 transition-transform dark:bg-blue-950/30 dark:text-blue-400",children:(0,s.jsx)(w.Z,{size:18})}),(0,s.jsx)("span",{className:"font-semibold text-sm",children:"Card"})]})]}),(0,s.jsx)("button",{onClick:()=>em("Cash"),disabled:F||0===c.length,className:"w-full py-4 rounded-xl bg-primary text-primary-foreground hover:bg-primary/90 font-bold shadow-lg shadow-primary/20 transition-all disabled:opacity-50 disabled:cursor-not-allowed active:scale-[0.98] flex items-center justify-center gap-2 text-lg",children:F?(0,s.jsx)(k.Z,{className:"animate-spin",size:24}):(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("span",{children:["Charge $",ed.toFixed(2)]})})})]})]}),(0,s.jsx)(x,{isOpen:O,onClose:()=>{$(!1),M(null),window.location.reload()},saleData:U})]})]})}},64547:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var s=r(3827),n=r(28670),a=r(43345),i=r(64090);function o(e){let{title:t}=e,[r,o]=(0,i.useState)(null),[l,d]=(0,i.useState)(!0);return(0,i.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/me");if(e.ok){let t=await e.json();o(t)}}catch(e){console.error("Failed to fetch user info",e)}finally{d(!1)}})()},[]),(0,s.jsxs)("header",{className:"flex items-center justify-between h-20 px-8 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 tracking-tight",children:t}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[(0,s.jsx)("span",{className:"w-2 h-2 rounded-full bg-green-500"}),l?"...":"Welcome back, ".concat(r?r.full_name:"Guest")]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-5",children:[(0,s.jsxs)("div",{className:"relative group",children:[(0,s.jsx)(n.Z,{size:18,className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400 group-focus-within:text-indigo-600 transition-colors"}),(0,s.jsx)("input",{type:"text",placeholder:"Quick search...",className:"w-[320px] pl-10 pr-4 py-2.5 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-100 focus:border-indigo-600 transition-all outline-none font-medium text-sm shadow-sm"})]}),(0,s.jsx)("div",{className:"h-8 w-[1px] bg-gray-200"}),(0,s.jsxs)("button",{className:"p-2.5 rounded-full bg-white border border-gray-200 text-gray-500 hover:text-indigo-600 hover:border-indigo-100 hover:bg-indigo-50 transition-all shadow-sm relative",children:[(0,s.jsx)(a.Z,{size:20}),(0,s.jsx)("span",{className:"absolute top-0 right-0 w-3 h-3 bg-rose-500 border-2 border-white rounded-full"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 pl-2",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-600 to-violet-600 text-white flex items-center justify-center font-bold shadow-lg shadow-indigo-200",children:l?"...":r?r.full_name.charAt(0).toUpperCase():"?"}),l?(0,s.jsx)("div",{className:"h-8 w-24 bg-gray-100 rounded animate-pulse"}):(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-sm font-bold text-gray-800 leading-tight",children:r?r.full_name:"Guest"}),(0,s.jsx)("span",{className:"text-xs text-gray-500 font-medium",children:r?r.role:"Visitor"})]})]})]})]})}}},function(e){e.O(0,[125,505,337,763,971,69,744],function(){return e(e.s=95779)}),_N_E=e.O()}]);